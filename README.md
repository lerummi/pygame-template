# pygame-template

A template for developing Pygame applications that can run in the browser using pygbag (Pygame WebAssembly).

## Overview

This project provides a complete development environment for creating Pygame games that run both natively and in web browsers. It includes Docker and devcontainer configurations for consistent development across different machines.

## Features

- **Python 3.13** with modern tooling
- **uv** for fast dependency management
- **pygbag** for WebAssembly compilation
- **Docker Compose** setup for isolated development
- **VS Code devcontainer** support
- Pre-configured to avoid common pygbag/Docker pitfalls

## Quick Start

### Option 1: Using Docker Compose (Recommended)

```bash
# Start the server
docker compose up

# Access your game at http://localhost:8000
```

### Option 2: Using VS Code Devcontainer / GitHub Codespaces

1. Open this project in VS Code or GitHub Codespaces
2. Click "Reopen in Container" when prompted (VS Code) or wait for Codespaces to finish setup
3. **Manually start the server** using one of these methods:
   - Run the command: `./start-server.sh`
   - Or use VS Code Command Palette (Cmd/Ctrl+Shift+P): `Tasks: Run Task` → `Start Pygbag Auto-Reload Server`
4. Access your game at http://localhost:8000
5. Server logs are visible in the Terminal output to monitor for errors

### Option 3: Local Development

```bash
# Install dependencies
uv sync

# Run the game
uv run pygbag app

# Access at http://localhost:8000
```

## Project Structure

```
.
├── app/
│   ├── main.py          # Your game code
│   └── build/           # Generated by pygbag (gitignored)
├── .devcontainer/       # VS Code devcontainer config
├── docker-compose.yml   # Docker Compose configuration
├── Dockerfile           # Docker image definition
├── pyproject.toml       # Python project dependencies
└── uv.lock              # Locked dependencies
```

## How It Works

The Docker/devcontainer setup uses a workaround for pygbag in containerized environments:

1. **Build Phase**: `pygbag --build` generates static HTML/JS/WASM files
2. **Asset Download**: Required pygame wheel is downloaded from CDN
3. **Serve Phase**: Python's HTTP server serves files without URL rewriting

This avoids browser security issues where pygbag's proxy would rewrite CDN URLs to use `0.0.0.0`, which browsers block.

### Auto-Rebuild on File Changes

When using the devcontainer or Docker Compose setup, a file watcher automatically monitors the `app/` directory for changes. When you save a file:

1. The watcher detects the change
2. Automatically triggers a rebuild of your game
3. Restarts the HTTP server with the updated build
4. **You manually refresh your browser** to see the changes

This provides a streamlined development workflow where you only need to save your code and refresh the browser.

## Development

Edit `app/main.py` to modify your game. The template includes a simple red square that you can move with arrow keys.

### With Docker Compose

After editing code:
```bash
docker compose restart
```

### With Devcontainer / GitHub Codespaces

The file watcher automatically rebuilds your game when you save changes. Simply:
1. Edit your code in `app/main.py`
2. Save the file (the watcher will automatically rebuild)
3. **Manually refresh your browser** to see changes
4. Monitor the Terminal for any errors or build output

The file watcher runs in the background and monitors `.py`, `.png`, `.jpg`, `.wav`, `.mp3`, and `.ogg` files in the `app/` directory.

### Local Development

Just refresh the browser - pygbag supports live reloading.

## Requirements

- **Docker**: For Docker Compose setup
- **VS Code**: For devcontainer support (optional)
- **Python 3.12+** and **uv**: For local development (optional)

## Troubleshooting

### Browser shows "Downloading..." forever

- Make sure you're accessing `http://localhost:8000`, NOT `http://0.0.0.0:8000`
- Clear browser cache and try again
- Check console for errors (F12 → Console)

### Port 8000 already in use

```bash
# Find and kill the process using port 8000
lsof -ti:8000 | xargs kill -9

# Or change the port in docker-compose.yml:
ports:
  - "8080:8000"  # Use 8080 instead
```

### Container fails to start

```bash
# Rebuild without cache
docker compose down
docker compose build --no-cache
docker compose up
```

## Resources

- [Pygame Documentation](https://www.pygame.org/docs/)
- [pygbag Documentation](https://pypi.org/project/pygbag/)
- [Pygame Web Examples](https://pygame-web.github.io/)

## License

This template is provided as-is for educational and development purposes.
