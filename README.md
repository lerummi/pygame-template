# pygame-template

A template for developing Pygame applications that can run in the browser using pygbag (Pygame WebAssembly).

## Overview

This project provides a complete development environment for creating Pygame games that run both natively and in web browsers. It includes Docker and devcontainer configurations for consistent development across different machines.

## Features

- **Python 3.13** with modern tooling
- **uv** for fast dependency management
- **pygbag** for WebAssembly compilation
- **Docker Compose** setup for isolated development
- **VS Code devcontainer** support
- **Auto-reload** on file changes
- **Multiple project support** - build from any directory
- Pre-configured to avoid common pygbag/Docker pitfalls

## Quick Start

### Option 1: Local Development (Fastest)

```bash
# Run from default 'app' directory
./start

# Or run from a specific directory (e.g., a tutorial or different project)
./start learn/1_tasten

# Access your game at http://localhost:8000
```

### Option 2: Using Docker Compose

```bash
# Start the server (default 'app' directory)
docker compose up

# Or specify a different directory
APP_DIR=learn/1_tasten docker compose up

# Access your game at http://localhost:8000
```

### Option 3: Using VS Code Devcontainer / GitHub Codespaces

1. Open this project in VS Code or GitHub Codespaces
2. Click "Reopen in Container" when prompted (VS Code) or wait for Codespaces to finish setup
3. Start the server with your desired directory:
   ```bash
   ./start                  # Default 'app' directory
   ./start learn/1_tasten   # Specific directory
   ```
4. Access your game at http://localhost:8000
5. Switch directories anytime by running `./start <directory>` again

### Option 4: Manual Local Development

```bash
# Install dependencies
uv sync

# Run the game from default 'app' directory
uv run pygbag app

# Or run from a specific directory
export APP_DIR=learn/1_tasten
uv run pygbag $APP_DIR

# Access at http://localhost:8000
```

## Project Structure

```
.
├── app/                 # Default game directory
│   ├── main.py          # Your game code
│   └── build/           # Generated by pygbag (gitignored)
├── learn/               # Tutorial/learning examples
│   └── 1_tasten/        # Example: keyboard input tutorial
│       └── main.py
├── .devcontainer/       # VS Code devcontainer config
├── docker-compose.yml   # Docker Compose configuration
├── Dockerfile           # Docker image definition
├── start                # Convenient launcher script
├── pyproject.toml       # Python project dependencies
└── uv.lock              # Locked dependencies
```

### Working with Multiple Directories

You can organize multiple projects or tutorials in separate directories. Each just needs a `main.py` file:

```bash
# Run different projects
./start app                  # Main project
./start learn/1_tasten       # Tutorial 1
./start projects/my-game     # Your custom project

# With Docker Compose
APP_DIR=learn/1_tasten docker compose up
```

## How It Works

The Docker/devcontainer setup uses a workaround for pygbag in containerized environments:

1. **Build Phase**: `pygbag --build` generates static HTML/JS/WASM files
2. **Asset Download**: Required pygame wheel is downloaded from CDN
3. **Serve Phase**: Python's HTTP server serves files without URL rewriting

This avoids browser security issues where pygbag's proxy would rewrite CDN URLs to use `0.0.0.0`, which browsers block.

### Auto-Rebuild on File Changes

When using the devcontainer or Docker Compose setup, a file watcher automatically monitors the `app/` directory for changes. When you save a file:

1. The watcher detects the change
2. Automatically triggers a rebuild of your game
3. Restarts the HTTP server with the updated build
4. **You manually refresh your browser** to see the changes

This provides a streamlined development workflow where you only need to save your code and refresh the browser.

## Development

Edit `app/main.py` to modify your game. The template includes a simple red square that you can move with arrow keys.

### With Docker Compose

After editing code:
```bash
docker compose restart
```

### With Devcontainer / GitHub Codespaces

The file watcher automatically rebuilds your game when you save changes. Simply:
1. Start the server with `./start` or `./start learn/1_tasten`
2. Edit your code in the active directory
3. Save the file (the watcher will automatically rebuild)
4. **Manually refresh your browser** to see changes
5. Monitor the Terminal for any errors or build output
6. Switch directories anytime with `./start <directory>`

The file watcher monitors `.py`, `.png`, `.jpg`, `.wav`, `.mp3`, and `.ogg` files in the active directory.

### Local Development

Just refresh the browser - pygbag supports live reloading.

## Requirements

- **Docker**: For Docker Compose setup
- **VS Code**: For devcontainer support (optional)
- **Python 3.12+** and **uv**: For local development (optional)

## Troubleshooting

### Browser shows "Downloading..." forever

- Make sure you're accessing `http://localhost:8000`, NOT `http://0.0.0.0:8000`
- Clear browser cache and try again
- Check console for errors (F12 → Console)

### Port 8000 already in use

```bash
# Find and kill the process using port 8000
lsof -ti:8000 | xargs kill -9

# Or change the port in docker-compose.yml:
ports:
  - "8080:8000"  # Use 8080 instead
```

### Container fails to start

```bash
# Rebuild without cache
docker compose down
docker compose build --no-cache
docker compose up
```

## Resources

- [Pygame Documentation](https://www.pygame.org/docs/)
- [pygbag Documentation](https://pypi.org/project/pygbag/)
- [Pygame Web Examples](https://pygame-web.github.io/)

## License

This template is provided as-is for educational and development purposes.
